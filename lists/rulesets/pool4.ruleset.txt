<!ruleset-list>

name '4er-Pool'
require exact 4

alloc $1
alloc $2
alloc $3
alloc $4

match #AvB {
    white $1
    blue $2
}
match #AvC {
    white $1
    blue $3
}
match #AvD {
    white $1
    blue $4
}
match #BvC {
    white $2
    blue $3
}
match #BvD {
    white $2
    blue $4
}
match #CvD {
    white $3
    blue $4
}

order #AvB, #CvD, _clip, #AvC, #BvD, _clip, #AvD, #BvC

score {
    calc points among all
    resolve playoff

    first %1
    second %2
    third %3, %4
}

-- UP
playoff {
    if equal at %3, %2, %1
    realloc $1, $2, $3
    
    match #upXvY {
        white $1
        blue $2
    }
    
    match #upXYvZ {
        white #upXvY.winner
        blue $3
    }
    
    order #upXvY, _clip, #upXYvZ
    
    first #upXYvZ.winner
    second #upXYvZ.loser
    third #upXvY.loser
}

-- DOWN
playoff {
    if equal at %4, %3, %2
    realloc $1, $2, $3
    
    match #downXvY {
        white $1
        blue $2
    }
    
    match #downXYvZ {
        white #downXvY.loser
        blue $3
    }
    
    order #downXvY, _clip, #downXYvZ
    
    first #downXvY.winner
    second #downXYvZ.winner
    third #downXYvZ.loser
}
